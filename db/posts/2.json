{"id":null,"date":"2020-11-11T09:24:10.951+0000","title":"Rest Over Websocket","description":" Spring Boot Websocket that wrapps Rest API","content":"<p id=\"913e\" class=\"xa xb vw nf b xd xe xf xg xh xi xj xk xl xm xn xo xp xq xr ax xs rz he\" data-selectable-paragraph=\"\">Over\r\n past couple of months, an idea has been scratching my mind, which \r\nseemed kinda stupid in the beginning but after studying more and more \r\nabout it… well I can say it makes more sense now, but perhaps its not \r\nperfect.</p><p id=\"af6b\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">As a back-end developer I have been using web frameworks, S<span id=\"rmm\"><span id=\"rmm\"><span id=\"rmm\"><span id=\"rmm\">p</span></span></span></span>ecially\r\n Java Spring Boot, to provide rest endpoints for clients. I have also \r\nhad some experience with websockets too. So one day, I was thinking of \r\ncreating a decentralized encrypted communication system and while \r\nlooking for protocols to use, this very weird thing came to my mind: <strong class=\"nf kb\">Combining websockets and rest api</strong>!\r\n (Just to mention, We are not talking about choosing Rest over \r\nWebsocket. We are talking about sending Rest requests over Websocket)</p><p id=\"8641\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">What does it even mean? Why? How? Implementation? keep reading.</p><h2 id=\"a2b2\" class=\"ye yf vw gs iu ahb yh ahc lo ahd yj ahe ls lt yl lu lw lx yn ly ma mb yp mc me yq he\" data-selectable-paragraph=\"\"><span style=\"font-weight: normal;\">What does it mean?</span></h2><p id=\"58da\" class=\"xa xb vw nf b xd yr xe xf xg ys xh xi xj yt xk xl xm yu xn xo xp yv xq xr xs rz he\" data-selectable-paragraph=\"\">First, let us remember what websocket is, and how it works.</p><blockquote class=\"yw yx yy\"><p id=\"3624\" class=\"xa xb yz nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">WebSocket\r\n is a computer communications protocol, providing full-duplex \r\ncommunication channels over a single TCP connection. The WebSocket \r\nprotocol was standardized by the IETF as RFC 6455 in 2011, and the \r\nWebSocket API in Web IDL is being standardized by the W3C. WebSocket is \r\ndistinct from HTTP.<br>- <a href=\"https://en.wikipedia.org/wiki/WebSocket\" class=\"fq vt\" rel=\"noopener nofollow\">wikipedia</a></p></blockquote><p id=\"ca1e\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">Also about its efficiency</p><blockquote class=\"yw yx yy\"><p id=\"54e4\" class=\"xa xb yz nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\"><strong class=\"nf kb\">WebSockets</strong> allow for a higher amount of efficiency compared to REST because they do not require the <strong class=\"nf kb\">HTTP</strong> request/response overhead for each message sent and received.<br>- <a href=\"https://blogs.windows.com/windowsdeveloper/2016/03/14/when-to-use-a-http-call-instead-of-a-websocket-or-http-2-0/\" class=\"fq vt\" rel=\"noopener nofollow\">Windows Blog</a></p></blockquote><p id=\"8151\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">Generally\r\n speaking, you might consider websockets in systems where you need live \r\nconnections, and you are trying to build everything on top of HTTP \r\nconnection, as websocket is just an upgrade to normal HTTP connection.</p><p id=\"8ba8\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">Two main advantages of using websockets that matters to this post, are:</p><ol><li id=\"6b43\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs za zb zc he\" data-selectable-paragraph=\"\">No need for handshakes for each request / response.</li><li id=\"fc7e\" class=\"xa xb vw nf b xd zd xe xf xg ze xh xi xj zf xk xl xm zg xn xo xp zh xq xr xs za zb zc he\" data-selectable-paragraph=\"\">Server can send messages to client</li></ol><p id=\"ef5e\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">So, to answer <strong class=\"nf kb\">what it means</strong>: We want to call HTTP Rest endpoints using Websocket protocol.</p><h3 id=\"56bf\" class=\"ye yf vw gs iu ahb yh ahc lo ahd yj ahe ls lt yl lu lw lx yn ly ma mb yp mc me yq he\" data-selectable-paragraph=\"\"><span style=\"font-weight: normal;\">Why?</span></h3><p id=\"993a\" class=\"xa xb vw nf b xd yr xe xf xg ys xh xi xj yt xk xl xm yu xn xo xp yv xq xr xs rz he\" data-selectable-paragraph=\"\">Exactly\r\n for those advantages mentioned earlier. First, by getting rid of too \r\nmany headers and handshakes on each request/response, and by having live\r\n connection, client can get faster and lighter responses than normal \r\nhttp request. Also, client can listen for changes in the data that has \r\npreviously retrieved from server by creating a subscription. This \r\nsubscription also can be used to send the newly added data to client \r\nafter client sent its initial request.</p><p id=\"3618\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">Another\r\n advantage of this in a world full of web frameworks is that the web \r\nframework you already use for your rest api calls can add support for \r\nthis protocol and without any changes on server-side, you can represent \r\nrest endpoints over websocket.</p><p id=\"e54f\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">One\r\n important key note here is that we can support rest methods such as \r\nGET/POST/DELETE/PUT … but of course this is not restful. The reason is \r\nthat rest standard suggests that connection should be <strong class=\"nf kb\">Stateless. </strong>Meaning that <em class=\"yz\">each\r\n request from client to server must contain all of the information \r\nnecessary to understand the request, and cannot take advantage of any \r\nstored context on the server. Session state is therefore kept entirely \r\non the client. (</em><a href=\"https://restfulapi.net/\" class=\"fq vt\" rel=\"noopener nofollow\"><em class=\"yz\">source</em></a><em class=\"yz\">).</em> So what we are creating here, might not follow all rest standards.</p><h3 id=\"148c\" class=\"ye yf vw gs iu ahb yh ahc lo ahd yj ahe ls lt yl lu lw lx yn ly ma mb yp mc me yq he\" data-selectable-paragraph=\"\"><span style=\"font-weight: normal;\"><span class=\"fw\">How?</span></span></h3><p id=\"814a\" class=\"xa xb vw nf b xd yr xe xf xg ys xh xi xj yt xk xl xm yu xn xo xp yv xq xr xs rz he\" data-selectable-paragraph=\"\">There\r\n are all sort of ways to create such protocol, but lets say our Websocket is only supposed to send text based messages, not binary. A \r\nHTTP req/res has bunch of parts that we know of: Headers, Body, \r\nParameters like query string. We can simply use a json based protocol \r\nthat supports all these different parts of request/response.</p><p id=\"fcf3\" class=\"xa xb vw nf b xd xt xe xf xg xu xh xi xj xv xk xl xm xw xn xo xp xx xq xr xs rz he\" data-selectable-paragraph=\"\">But\r\n unlike HTTP where each response is for a single request, in Websocket, \r\nevery message sent from server to client, can be response for a request \r\nor just a message to be published to listeners. To make a difference \r\nbetween these two types of messages, we need a request id attached to \r\nrequest, so we can map a response to requests by returning that request \r\nid and then call valid callback for the request.</p><span class=\"yb is dv yc yd en\"></span><span class=\"yb is dv yc yd en\"></span><p id=\"8000\" class=\"xa xb vw nf b xd yr xe xf xg ys xh xi xj yt xk xl xm yu xn xo xp yv xq xr xs rz he\" data-selectable-paragraph=\"\">I have prepared an example of ROW (Rest Over websocket) <a href=\"https://github.com/idioglossia/spring-rest-over-ws\" class=\"fq vt\" rel=\"noopener nofollow\">here</a>.\r\n Its a spring boot starter lib that makes ready to use websocket \r\nendpoint for your “already defined” rest Api’s in Java Spring \r\nenvironment. <span class=\"yb is dv yc yd en\"></span>Every\r\n technology as its own advantages and disadvantages. Using the protocol \r\nabove has at least all the disadvantages that come with using websocket.\r\n <a href=\"https://nexocode.com/blog/posts/websockets-friend-or-foe/\" class=\"fq vt\" rel=\"noopener nofollow\">Read this article for more information</a>.</p><p id=\"8000\" class=\"xa xb vw nf b xd yr xe xf xg ys xh xi xj yt xk xl xm yu xn xo xp yv xq xr xs rz he\" data-selectable-paragraph=\"\"><br></p>","followUpButton":{"text":"See Project in Github","link":"https://github.com/idioglossia/spring-rest-over-ws"},"username":"admin","tags":["java & spring","tools"],"cover":"df851a61-9bb4-4b80-98ff-1f68a16d3683.jpg","thumbnail":null}